var PaperValidate=function(){function e(){$('form input[type="text"]').eq(0).focus()}function t(){var t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=24&M=3&t=1",a=ReadData(t);InitSelect("prod_id",a),t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=23&M=3&t=1",a=ReadData(t),InitSelect("machine_id",a),t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=25&M=3&t=2",a=ReadData(t),InitSelect("oper_id",a),$("[name=passed]").iCheck("check"),$("input[name='rec_date']").val(today(6)),$("input[name='reel_code']").maxlength({limitReachedClass:"label label-danger",threshold:3}),initSelect2(),$(".page-header .dropdown-quick-sidebar-toggler").hide(),SetiCheckChecked("passed",1),e()}function a(){var e=$('select[name="prod_id"]').val()+$('input[name="reel_code"]').val(),t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=113&M=0&r="+e,a=ReadData(t);return"0"===a.rows?0:($('input[name="reel_code"]').data("reelcode",e),a.header.map(function(e){var t=e.title;$('form .form-control[name="'+t+'"]').val(a.data[0][t])}),SetSelect2Val("oper_id",a.data[0].oper_id),SetSelect2Val("prod_id",a.data[0].prod_id),SetSelect2Val("machine_id",a.data[0].machine_id),SetSelect2Val("number_right",a.data[0].number_right),SetiCheckChecked("passed",a.data[0].passed),$('.portlet button[type="submit"]').data("sn",a.data[0].id).html('更新  <i class="icon-cloud-upload"></i>'),i.updateMode=1,bsTips("历史数据载入成功",1),1)}function r(){var e=""!==$("[name=reel_end]").val()||""!==$("[name=suspect_paper]").val()||""!==$("[name=well_paper]").val()||""!==$("[name=other]").val(),t=GetiCheckChecked("passed");return e?$(".err-reason").closest(".form-group").removeClass("has-error"):t||$(".err-reason").closest(".form-group").addClass("has-error"),e||t}var i={initLoad:!0,updateMode:0},n=function(){jQuery().datepicker&&$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"yyyy-mm-dd"})};$('input[name="reel_code"]').on("blur",function(e){$(this).val().length>1&&"-1"!==$('select[name="Prod_id"]').val()?a()&&$('.portlet button[type="submit"]').html('更新  <i class="icon-cloud-upload"></i>'):1==i.updateMode&&$(this).data("reelcode")!=$(this).val()&&$('.portlet button[type="submit"]').html('提交  <i class="icon-cloud-upload"></i>')}),$('input[name="reel_code"]').on("keyup",function(){var e=$(this);1==e.val().length&&SetSelect2Val("machine_id",e.val())}),$(".err-reason").on("keyup",function(){$(".err-reason").closest(".form-group").removeClass("has-error")}),$('input[name="cut_weight"]').on("keyup",function(){1==GetiCheckChecked("passed")&&$('input[name="package_weight"]').val($(this).val())});var s=function(){function t(){var e=getRootPath()+"/DataInterface/insert",t=getFormData("theForm");t.tbl=TBL.PPR_VALIDATE,t.utf2gbk=["reel_end","suspect_paper","well_paper"],t.record_Time=today(1),t.passed=GetiCheckChecked("passed"),$.ajax({url:e,type:"POST",data:t,success:function(e){var a=$.parseJSON(e);bsTips(a.message,a.type),n(),t.passed?bsTips("该轴放行，如需修改数据，请重新输入轴号载入信息",1):bsTips("该轴不放行，如需修改数据，请重新输入轴号载入信息")},error:function(e){bsTips("数据添加失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e))}})}function a(){var e=getRootPath()+"/DataInterface/update",t=getFormData("theForm");t.tbl=TBL.PPR_VALIDATE,t.utf2gbk=["reel_end","suspect_paper","well_paper"],t.record_Time=today(1),t.passed=GetiCheckChecked("passed"),t.id=$('.portlet button[type="submit"]').data("sn"),$.ajax({url:e,type:"POST",data:t,success:function(e){var a=$.parseJSON(e);bsTips(a.message,a.type),n(),0==t.passed?bsTips("该轴不放行，如需修改数据，请重新输入轴号载入信息"):1==t.passed?bsTips("该轴放行，如需修改数据，请重新输入轴号载入信息",1):2==t.passed?bsTips("该轴不统计，如需修改数据，请重新输入轴号载入信息",1):3==t.passed&&bsTips("该轴待放行，如需修改数据，请重新输入轴号载入信息",1)},error:function(e){bsTips("数据更新失败，请稍后重试或联系管理员!",0),infoTips(e)}})}function n(){$('.validateData input[type="text"]').val(""),$('input[name="reel_code"]').val(""),e(),SetiCheckChecked("passed",1),$('input[name="package_weight"]').val(0)}var s={reel_code:{minlength:4,maxlength:7,number:!1,required:!0},prod_id:{required:!0},cut_weight:{required:!0},package_weight:{required:!0}};$("form[name=theForm]").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!0,rules:s,messages:{reel_code:{required:"轴号不能为空."},cut_weight:{required:"切纸抄重不能为空."},package_weight:{required:"切纸抄重不能为空."}},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},submitHandler:function(e){}}),$('button[type="submit"]').on("click",function(){$("form[name=theForm]").validate().form()&&r()?0===i.updateMode?t():a():bsTips("请确保所有必要信息均正确输入")}),$('a[name="reset"]').on("click",function(){n()})},o=function(){return $('table[name="unPassedList"] tbody').on("click","a",function(){var e=$(this).data("id"),t=$(this).data("weight"),a=$(this),r=getRootPath()+"/DataInterface/update";$.ajax({type:"POST",async:!1,url:r,data:{id:e,passed:1,package_weight:t,tbl:TBL.PPR_VALIDATE},success:function(){bsTips("该轴号成功放行",2),a.parents("tr").remove(),0===$("table a").length&&$('table[name="unPassedList"] tbody').html('<tr><td class="text-center" colspan="7">近期所有产品均已通过检验</td></tr>')},error:function(e){infoTips("放行失败，请联系系统管理员!",0),infoTips(JSON.stringify(e))}})}),{loadUnPassedData:function(){var e=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=114&M=2",t=ReadData(e),a="";t.rows>0?(t.data.map(function(e){a+="<tr><td>"+e.ProductName+"</td><td> "+e.Machine_Name+" </td><td> "+e.reel_code+"</td><td> "+e.record_Time+"</td><td> "+e.cut_weight+"</td><td> "+e.package_weight+'</td><td><a href="javascript:;" class="btn sbold uppercase btn-outline blue" data-id='+e.ID+" data-weight="+e.cut_weight+'><i class="fa fa-credit-card"></i> 放行 </a></td></tr>'}),$('table[name="unPassedList"] tbody').html(a)):$('table[name="unPassedList"] tbody').html('<tr><td class="text-center" colspan="7">近期所有产品均已通过检验</td></tr>')}}}();return{init:function(){n(),t(),s(),o.loadUnPassedData()}}}();jQuery(document).ready(function(){initDom(),iChechBoxInit(),PaperValidate.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=PaperValidate.min.js.map