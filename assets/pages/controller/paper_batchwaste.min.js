var FakePiece=function(){function e(){var e={url:o(),type:"pie",background:"img",circle:1};require(["../assets/pages/controller/singleChart.min"],function(t){t.init(e,$('[name="singleChart"]'))})}function t(){var e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=24&M=3&t=1";$.ajax({url:e}).done(function(e){var t=handleAjaxData(e);InitSelect("prod_id",t)}),e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=23&M=3&t=0",$.ajax({url:e}).done(function(e){var t=handleAjaxData(e);InitSelect("machine_id",t)}),initSelect2()}function a(){t(),$("input[name='rec_date']").val(today(6)),$("input[name='remark']").val("无"),$(".page-header .dropdown-quick-sidebar-toggler").hide(),l()}function n(){SetSelect2Val("prod_id",-1),SetSelect2Val("machine_id",-1),$('[name="reel_code"]').val(""),$(".detail input").val(""),$("[name='remark']").val("无"),$("[name='reel_code']").focus()}function r(){var e=getRootPath()+"/DataInterface/insert",t=getFormData("theForm");t.utf2gbk=["remark","fake_reason"],t.tbl=TBL.PPR_BATCHWASTE;var a={url:e,type:"post",resetForm:!0,data:t,success:function(e){var t=$.parseJSON(e);bsTips(t.message,t.type),n(),i()},error:function(e){infoTips(JSON.stringify(e))}};return $.ajax(a),!1}function i(){var e=$('[name="fakeList"] tbody'),t=$("input[name='rec_date']").val();t=t.replace(/-/g,"");var a=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=248&M=3&tstart="+t+"&tend="+t;$.ajax({url:a}).done(function(t){function a(e,t){var a="<tr>\t<td>"+t+"</td>";return e.map(function(e){a+="\t<td>"+e+"</td>"}),a+="</tr>"}if(t=handleAjaxData(t),0===t.rows)return void e.html('<tr><td class="text-center" colspan='+(t.cols+1)+">指定时间内无数据</td></tr>");var n="";t.data.map(function(e,t){n+=a(e,t+1)}),e.html(n)})}function o(){var e=$("input[name='rec_date']").val();e=e.replace(/-/g,"");var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=250&M=3&tstart="+e;return t}var c=function(){jQuery().datepicker&&$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"yyyy-mm-dd"})},l=function(){$("input[name='reel_code']").maxlength({limitReachedClass:"label label-danger",threshold:3}),extendValidateRule();var e=getValidateRule("theForm");e.reel_code={minlength:8,maxlength:8,isReelCode:!0,required:!0},e.rec_date.number=!1,e.fake_num={number:!0,required:!0,min:.1},e.fake_reason={required:!0},$("form[name=theForm]").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!0,rules:e,messages:{reel_code:{required:"轴号不能为空."}},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},submitHandler:function(e){r()}})};return $('input[name="reel_code"]').on("keyup",function(){var e=$(this).val();if(e.length>=2){var t=e.substr(1,1);7==t&&(t=8);var a=e.substr(2,1);SetSelect2Val("prod_id",t),SetSelect2Val("machine_id",a)}}),$('[name="reset"]').on("click",function(){n()}),{init:function(){c(),a(),e(),i()}}}();jQuery(document).ready(function(){initDom(),FakePiece.init()}),jQuery(window).resize(function(){HeadFix()});