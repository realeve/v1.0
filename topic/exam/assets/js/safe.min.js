require.config({baseUrl:"assets/js",paths:{jquery:"jquery.min","jquery-weui":"jquery-weui","jquery.fullPage":"jquery.fullPage.min"},shim:{"jquery.fullPage":{deps:["jquery"]},"jquery-weui":{deps:["jquery"]}}});var exam={total:0,error:[],answerList:[],isAnswered:[],timeReleased:!1,isStarted:!1,timeLength:0,sourceList:[],scoresPerAnswer:0,isSubmit:!1,isLogin:!1,loginData:{},maxAnswerNum:20,answerTimes:20,examPaper:"test"},lastPage;require(["jquery","jquery.fullPage","jquery-weui"],function(e){function a(e,a){var t=[],i=[];i=n(e.question.length);var s=[];i.map(function(e,a){s[e]=a});var r='<div class="section '+(a%2?"":"background_dark_img")+'">';r+='<h1 class="title answer-num ">第<span>'+a+"</span>题</h1>",r+='<div class="weui_cells_title ">'+e.title+"</div>",r+='<div class="weui_cells weui_cells_checkbox'+(a%2?"":" weui_cells_dark")+'" data-id='+(a-1)+" data-answer="+(s[e.answer-1]+1)+">",e.question.map(function(e,n){t[n]="",t[n]+='    <label class="weui_cell weui_check_label">',t[n]+='<div class="weui_cell_hd">',t[n]+='    <input type="radio" class="weui_check" name="radio'+(a-1)+'">',t[n]+='    <i class="weui_icon_checked"></i>',t[n]+="</div>",t[n]+='<div class="weui_cell_bd weui_cell_primary" data-value='+s[n]+">",t[n]+="    <p>"+e+"</p>",t[n]+="</div></label>"});for(var o="",l=0;l<e.question.length;l++)o+=t[i[l]];return r+=o+"</div></div>"}function t(e,a){return Math.random()>.5?-1:1}function n(e){for(var a=[],n=0;e>n;n++)a.push(n);return a.sort(t)}function i(e,a){return e.substring(e.length-a,e.length)}function s(e){var a,t=new Date,n=t.getFullYear(),s=i("0"+(t.getMonth()+1),2),r=i("0"+t.getDate(),2),o=t.getHours(),l=t.getMinutes(),u=t.getSeconds();switch(e){case 0:a=n+"年"+s+"月"+r+"日";break;case 1:a=n+"-"+s+"-"+r+" "+o+":"+l+":"+u;break;case 2:a=n+"年"+s+"月"+r+"日"+o+"时"+l+"分"+u+"秒";break;case 3:a=n+"-"+s+"-"+r+" "+o+":"+l;break;case 4:a=n+"年"+s+"月"+r+"日  "+o+"时"+l+"分";break;case 5:a=s+"/"+r+"/"+n;break;case 6:a=n+"-"+s+"-"+r}return a}var r=[],o=-1==window.location.href.indexOf("?m=")?0:window.location.href.split("?m=")[1].split("&")[0];exam.maxAnswerNum=0===o?exam.maxAnswerNum:2,e('[name="sucessInfo"] .weui_msg_title').hide(),e.getJSON("./assets/data/department.min.json",function(a){var t=(a.length,[]);a.map(function(e){t.push(e.name)}),e('[name="user_dpt"]').picker({title:"上下滑动选择您的部门",cols:[{textAlign:"center",values:t}]})}),e.getJSON("./assets/data/"+exam.examPaper+".min.json",function(t){var i=t.length;exam.sourceList=n(i),i=i<=exam.maxAnswerNum?i:exam.maxAnswerNum,e('[name="nums"]').text(i),exam.scoresPerAnswer=100/i,e('[name="scores"]').text(exam.scoresPerAnswer.toFixed(0));for(var s=0;i>s;s++)e('[name="sucessInfo"]').before(a(t[exam.sourceList[s]],s+1)),exam.isAnswered[s]=0;var o='<div class="weui_opr_area"><p class="weui_btn_area"><a href="javascript:;" class="weui_btn weui_btn_primary" id="submit">交卷</a></p></div>';for(e(".answer-num").last().parent().append(o),lastPage=i+3,s=0;lastPage>s;s++)r[s]=s%2?"#fff":"#445"}).done(function(){document.getElementById("autoplay").play(),l()});var l=function(){function a(){e.alert("答题时间到，系统将不再记录此后的得分，请提交当前成绩！","时间到！",function(){e.fn.fullpage.moveTo(lastPage)})}function t(a,t,n){var i=a-2;return"down"!=n||exam.isLogin||exam.timeReleased?("down"==n&&!exam.timeReleased&&i>0&&lastPage-2>i&&!exam.isAnswered[i-1]&&e.alert("第"+i+"题您还没有作答！","警告！",function(){e.fn.fullpage.moveTo(a)}),void(a>lastPage&&"down"==n&&e(".iSlider-arrow").hide())):void setTimeout(function(){e.fn.fullpage.moveTo(2)},200)}function n(a){var t=!0;return""==a.user_name?(e('[name="userName"]').parents(".weui_cell").find("label").css("color","#e64340"),t=!1):e('[name="userName"]').parents(".weui_cell").find("label").attr("style",""),""==a.user_dpt?(e('[name="user_dpt"]').parents(".weui_cell").find("label").css("color","#e64340"),t=!1):e('[name="user_dpt"]').parents(".weui_cell").find("label").attr("style",""),""==a.user_id?(e('[name="userCard"]').parents(".weui_cell").find("label").css("color","#e64340"),t=!1):e('[name="userCard"]').parents(".weui_cell").find("label").attr("style",""),t}function i(a,t){var n="";a>=80?n="恭喜您获奖！请根据部门通知领取答题奖品！":(1==exam.loginData.iTimes&&(n="您还有一次答题机台，退出页面重新进入即可，下次继续努力哦！"),n="下次继续努力哦！安全生产离不开您的参与！"),e('[name="sucessInfo"] .weui_msg_desc').html('提交成功，您一共得了<span name="totalScore" style="font-weight:bold;color:#445"> '+a+" </span>分"),e(".weui_icon_msg").last().addClass("weui_icon_success").removeClass("weui_icon_warn"),e('[name="scoreLink"]').attr("href","./safeScore.html?uid="+t),e('[name="sucessInfo"] .weui_msg_title').text(n).show()}function r(){var a=!0;exam.isAnswered.map(function(t,n){if(!t){var i=n+1;e.toast("第"+i+"题尚未作答，请先填写完所有题目再交卷"),a=!1}})}function o(a){e.ajax({url:"http://cbpc540.applinzi.com/index.php?s=/addon/GoodVoice/GoodVoice/setSafeExamData",data:a,success:function(t){0==t.status?e('[name="sucessInfo"] .weui_msg_title').text("提交失败，请稍后重试"):-1==t.status?e('[name="sucessInfo"] .weui_msg_title').text("该用户已提交数据"):(i(a.score,a.uid),a.score==exam.loginData.oldScore?e.alert("本次得分"+a.score+"与上一次相同，系统将不保存此次得分","警告！"):a.score<exam.loginData.oldScore&&e.alert("系统检测到本次得分"+a.score+"比上次更低，系统将不保存此次得分","警告！")),e.fn.fullpage.moveSectionDown()},error:function(a){var t="提交失败，请退出页面重新进入";e('[name="sucessInfo"] .weui_msg_title').text(t).show()}}).always(function(){exam.isSubmit=!0,e("#submit").hide()})}e(".weui_check_label").on("click",function(a){if(exam.timeReleased)a.preventdefault(),e.fn.fullpage.moveTo(lastPage),e.alert("答题时间到，系统将不再记录此后的得分，请提交当前成绩！","时间到！");else{var t=e(this).parents(".weui_cells"),n=e(this).find(".weui_cell_primary"),i=n.data("value")+1==t.data("answer")?1:0,s=t.data("id");exam.answerList[s]=i,exam.isAnswered[s]=1,s<exam.maxAnswerNum-1&&setTimeout(function(){e.fn.fullpage.moveTo(s+4)},300)}}),e("#fullpage").fullpage({easingcss3:"cubic-bezier(0.25, 0.5, 0.35, 1.15)",onLeave:function(n,i,s){exam.timeLength&&1==n&&!exam.timeReleased&&(exam.isStarted=!0,setTimeout(function(){exam.timeReleased=!0,a()},exam.timeLength),setTimeout(function(){e.toast("考试时间已过去三分之一")},.33*exam.timeLength),setTimeout(function(){e.toast("考试时间仅剩三分之一")},.67*exam.timeLength)),t(n,i,s)},afterLoad:function(a,t){t==lastPage-1?e(".iSlider-arrow").hide():t==lastPage?(e(".iSlider-arrow").hide(),exam.isSubmit||setTimeout(function(){e.fn.fullpage.moveSectionUp()},500)):e(".iSlider-arrow").show()}}),e(".weui_msg").removeClass("hidden"),e('[name="login"] input').on("focus",function(){e(this).parents(".weui_cell").find("label").attr("style","")}),e("#login").on("click",function(){var a={user_name:e('[name="userName"]').val().trim(),user_id:e('[name="userCard"]').val().trim(),user_dpt:e('[name="user_dpt"]').val()};a.user_firstname=a.user_name.substr(0,1),n(a)?e.ajax({url:"http://cbpc540.applinzi.com/index.php?s=/addon/GoodVoice/GoodVoice/examSafeLogin",data:a,success:function(t){0==t.id?e.alert("登录失败，请检查您的卡号及部门","警告！"):t.first_name.trim()!=a.user_firstname?e.alert("登录失败，您的姓名可能填写错误","警告！"):t.answer_times>=exam.answerTimes?e.alert("您已用完"+exam.answerTimes+"次答题机会","警告！"):(exam.isLogin=!0,exam.loginData=a,exam.loginData.uid=t.id,exam.loginData.iTimes=Number.parseInt(t.answer_times)+1,exam.loginData.oldScore=exam.loginData.iTimes>=1?Number.parseInt(t.score):0,exam.loginData.loginTime=s(1),exam.loginData.iTimes>1&&e.modal({title:"提示",text:"您已经提交过答案，是否继续作答?",buttons:[{text:"再做一遍",onClick:function(){e(this).parents(".section").hide(),e.fn.fullpage.moveSectionDown()}},{text:"查看成绩",onClick:function(){window.location.href="./safeScore.html?uid="+t.id}}]}))},error:function(a){e.alert("登录失败，请刷新重试","警告！")}}):e.toast("请输入个人用户信息","cancel")}),e("#submit").on("click",function(a){if(exam.error=[],exam.total=0,exam.answerList.map(function(e,a){exam.total+=e,e||exam.error.push(exam.sourceList[a])}),r){var t="";exam.error.map(function(e){t+=e+","}),t=t.length?t.substring(0,t.length-1):"-1";var n={score:(exam.total*exam.scoresPerAnswer).toFixed(0),errors:t,rec_time:s(1),start_time:exam.loginData.loginTime,uid:exam.loginData.uid,iTimes:exam.loginData.iTimes,oldScore:exam.loginData.oldScore};e.confirm("您确定要交卷吗?","交卷",function(){o(n)},function(){e.fn.fullpage.moveTo(2)}),e.modal({title:"提示",text:"您确定要交卷吗?",buttons:[{text:"交卷",onClick:function(){o(n)}},{text:"检查一遍",onClick:function(){e.fn.fullpage.moveTo(3)}}]})}})};(function(){var e=document.getElementById("autoplay"),a=document.getElementById("musicBtn"),t=document.getElementById("musicBtnTxt");document.getElementById("musicBtn").addEventListener("touchstart",function(){t.style.display="",e.paused?(e.play(),a.className="music-btn on",t.innerHTML="开始"):(e.pause(),a.className="music-btn",t.innerHTML="关闭"),setTimeout(function(){t.style.display="none"},1e3)},!1)})()});
//# sourceMappingURL=safe.min.js.map