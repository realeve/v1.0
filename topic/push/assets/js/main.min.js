!function(){function a(a,t){return a.substring(a.length-t,a.length)}function t(a,t){return a.substring(0,a.length-t)}function s(t){var s,n=new Date,e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],o=n.getFullYear(),c=n.getMonth()+1,u=n.getDate(),l=e[n.getDay()],r=a("0"+n.getHours(),2),i=a("0"+n.getMinutes(),2),g=a("0"+n.getSeconds(),2);switch(t){case 0:s=o+"年"+c+"月"+u+"日";break;case 1:s=o+"-"+c+"-"+u+" "+r+":"+i+":"+g;break;case 2:s=o+"年"+c+"月"+u+"日"+r+"时"+i+"分"+g+"秒";break;case 3:s=o+"-"+c+"-"+u+" "+r+":"+i;break;case 4:s=o+"年"+c+"月"+u+"日  "+r+"时"+i+"分";break;case 5:s=c+"/"+u+"/"+o;break;case 6:s=o+"-"+c+"-"+u;break;case 7:s=o.toString()+a("0"+c,2)+a("0"+u,2);break;case 8:s=o.toString()+a("0"+c,2);break;default:s=c+"月"+u+"日 "+l+" "+r+":"+i+":"+g}return s}var n=function(a,t,n){n=void 0===n?36e5:0;!function(a,t){$.ajax({url:"http://10.8.2.133/DataInterface/rtxPush",type:"get",async:!1,data:{delaytime:n,msg:a,receiver:t,title:"质量控制中心 "+s()},dataType:"jsonp",callback:"JsonCallback",success:function(a){console.log(s(1)+"    "+a.msg)},error:function(a){console.log(s(1)+"    "+a.msg)}})}(a,t)},e=function(){var a="",t={msg:"",status:0};return $.ajax({url:"http://10.8.2.133:70/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=102&M=3&t=75",type:"get",async:!1,dataType:"jsonp",callback:"JsonCallback",success:function(s){s.rows>0?(t.status=1,s.data.map(function(t,s){a+=t[1]+" 好品率较低("+t[11]+"%)\n"}),a+="\n[(点击此处查看详情)|http://10.8.2.133/dashboard]"):console.log("该时间内无相关数据")}}),t.msg=a,t},o=function(a){a=a;var t,s,n=")印码机检好品率:\n",e={msg:"",status:0},o={data:{},prod:{}};return $.ajax({url:"http://10.8.2.133:70/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=109&M=3",type:"get",async:!1,dataType:"jsonp",callback:"JsonCallback",success:function(c){c.rows>0?(e.status=1,c.data.map(function(a,s){void 0===o.data[a[1]]&&(o.data[a[1]]={},o.prod[s]=a[1]),a[0]>1e7?(t=a[0],o.data[a[1]].lastDay=a[2]):o.data[a[1]].theMonth=a[2]}),$.each(o.prod,function(a,t){var s;if(void 0!==o.data[t].lastDay){var e=o.data[t].lastDay-o.data[t].theMonth;s=(e=e.toFixed(2))>0?"↑"+e:0==e?"-":"↓"+-e,n+=t+" : "+o.data[t].lastDay+" ("+s+"%);\n"}}),s=(a?"今日":"昨日(")+t+n,s+="[(点击此处查看详情)|http://10.8.2.133/qualitychart?tid=109&type=bar]"):(e.status=0,console.log("当前时间范围内无数据"))}}),e.msg=s,e},c=function(){var a="\n\n----平均未检数最多的机台:----\n",t={msg:"",status:0};return $.ajax({url:"http://10.8.2.133:70/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=110&M=3",type:"get",async:!1,dataType:"jsonp",callback:"JsonCallback",success:function(s){if(s.rows>0){t.status=1;for(var n=0;n<4;n++)a+=s.data[n][0]+" : "+s.data[n][1]+" 大张/万\n";a+="[(点击此处查看详情)|http://10.8.2.133/qualitychart?tid=137&type=bar]\n"}else console.log("该时间内无相关数据"),t.status=0,a="\n\n----无机检未检信息----\n"}}),t.msg=a,t},u=function(){var a="----本月钞纸各品种封包率:----\n",t={msg:"",status:0};return $.ajax({url:"http://10.8.2.133:70/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=138&M=3",type:"get",async:!1,dataType:"jsonp",callback:"JsonCallback",success:function(s){s.rows>0?(t.status=1,s.data.map(function(t){a+=t[0]+" : "+t[1]+"%(封包率),"+t[2]+"%(返工率)\n"}),a+="[(点击此处查看详情)|http://10.8.2.133:70/qualitychart?tid=139&type=pie&circle=1]\n"):(console.log("该时间内无相关数据"),t.status=0,a="\n\n----无封包/返工信息----\n")}}),t.msg=a,t},l=function(){var a="";return $.ajax({url:"./assets/data/all.json",async:!1,success:function(s){s.dataCode.map(function(t,s){a+=t[3]+","}),a=t(a,1)}}),a},r=function(a,t){t=t,$.ajax({url:"./assets/data/all.json",async:!1,success:function(s){s.dataPrint.map(function(s,e){n(s[1]+(t?",中午好!":",早上好!")+a,s[3].toString(),0)})}})},i=function(){var a="http://10.8.2.133:70/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=60&M=3&tstart="+s(8)+"01&tend="+s(8)+"31",t="\n----本月钞纸过程质量控制水平如下:----\n",n={msg:"",status:0};return $.ajax({url:a,type:"get",async:!1,dataType:"jsonp",callback:"JsonCallback",success:function(a){a.rows>0?(n.status=1,a.data.map(function(a,s){t+=a[0]+" : "+a[3]+" 分\n"}),t+="[(点击此处查看详情)|http://10.8.2.133:70/qualitytable?tid=60]\n"):(console.log("该时间内无相关数据"),n.status=0,t="\n\n----无本月相关钞纸过程质量控制水平检测数据----\n")}}),n.msg=t,n},g=function(a){$.ajax({url:"./assets/data/all.json",async:!1,success:function(t){t.dataPaperGY.map(function(t,s){n(t[1]+",早上好!"+a,t[3].toString(),0)})}})},d=function(a,t){var s,e="http://10.8.2.133/datainterface/isrtxonline?rtxid="+t;$.ajax({url:e,type:"get",async:!1,dataType:"jsonp",callback:"JsonCallback",success:function(t){var e="";t.data.map(function(a){a.status>0&&(e+=a.rtxID+",")}),s=e.substr(0,e.length-1),n(a,s)}})},p=function(a){var t=l();d(a,t)},f=function(a){void 0===a&&(a=0);var t=new Date,s=t.getDay(),n=t.getHours(),e=t.getMinutes(),o=1;return 0==s||6==s?o=0:0==a?n>=8&&n<23?8==n&&e<30&&(o=0):o=0:1==a?7!=n&&(o=0):2==a&&12!=n&&(o=0),o};!function(){var a={};a.count=0,a.online=setInterval(function(){if(f()){var t=e();t.status>0&&(p(t.msg),500==a.count&&window.console.clear(),a.count++)}else console.log("实时质量推送消息 时间校验未通过:     "+s(3))},12e5),a.lastDay=setInterval(function(){if(f(1))if(void 0===localStorage.pushLog&&(localStorage.pushLog='{"today":"0"}'),$.parseJSON(localStorage.pushLog).today<s(7)){localStorage.pushLog=JSON.stringify({today:s(7)});var a=o(0),t=c(),n="";a.status>0&&(n+=a.msg),t.status>0&&(n+=t.msg),a.status+t.status>0&&r(n,0),console.log(n);var e=i(),l=u();e.status+l.status>0&&g(e.msg+l.msg)}else console.log("当天已推送该信息:   "+s(3));else console.log("每天推送消息 时间校验未通过:     "+s(3));if(f(2))if(void 0===localStorage.todayPushLog&&(localStorage.todayPushLog='{"today":"0"}'),$.parseJSON(localStorage.todayPushLog).today<s(7)){localStorage.todayPushLog=JSON.stringify({today:s(7)});var a=o(1),t=c(),n="";a.status>0&&(n+=a.msg),t.status>0&&(n+=t.msg),a.status+t.status>0&&r(n,1),console.log(n)}else console.log("当天已推送该信息:   "+s(3));else console.log("每天推送消息 时间校验未通过:     "+s(3))},18e5)}()}();